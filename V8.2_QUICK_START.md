# V8.2 å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸš€ ç«‹å³å¼€å§‹

### Windows
```
start_v8.2_training.bat
```

### Linux/Mac
```bash
python train_v8.2_local.py
```

---

## âœ¨ V8.2 å…³é”®æ”¹è¿›ï¼ˆåŸºäº V8.1ï¼‰

### ğŸ¯ æ ¸å¿ƒä¼˜åŒ–

#### 1. éªŒè¯å¹³æ»‘æ ¸ = 3ï¼ˆé‡è¦ï¼ï¼‰
- **ä» 5 é™åˆ° 3**
- æ›´å¥½åœ°ä¿ç•™çŸ­æ—¶æ®µè¡Œä¸º
- å‡å°‘è¿‡åº¦å¹³æ»‘å¯¼è‡´çš„æ®µä¸¢å¤±

#### 2. é™ä½ Sniff ç±»é˜ˆå€¼ï¼ˆæå‡å¬å›ï¼‰
```yaml
sniffgenital: 0.25  # â†“ from 0.26
sniffface:    0.26  # â†“ from 0.28
sniffbody:    0.25  # â†“ from 0.28
```

#### 3. å¢å¤§ sniffbody åˆå¹¶é—´éš™
```yaml
sniffbody merge_gap: 8  # â†‘ from 6
```
æ›´å®¹æ˜“åˆå¹¶ç¢ç‰‡åŒ–çš„ sniffbody æ®µ

#### 4. ä¿æŒçš„ä¼˜åŒ–
- âœ… è¿åŠ¨é—¨æ§ï¼ˆescape/chase â‰¥80 px/s, freeze â‰¤7 px/sï¼‰
- âœ… Intromit/Mount æ ¡å‡†
- âœ… æ¯ä¸ª epoch è®¡ç®— Kaggle F1
- âœ… åŸºäº Kaggle F1 ä¿å­˜æœ€ä½³æ¨¡å‹

---

## ğŸ“Š V8.2 vs V8.1 å¯¹æ¯”

| ç‰¹æ€§ | V8.1 | V8.2 |
|------|------|------|
| éªŒè¯å¹³æ»‘æ ¸ | 5 | **3** â­ |
| sniffgenital | 0.26 | **0.25** |
| sniffface | 0.28 | **0.26** |
| sniffbody | 0.28 | **0.25** |
| sniffbody merge_gap | 6 | **8** |
| è¿åŠ¨é—¨æ§ | âœ… | âœ… |
| Kaggle F1 è·Ÿè¸ª | âœ… | âœ… |

---

## ğŸ¯ é¢„æœŸæ”¹è¿›

ç›¸æ¯” V8.1ï¼š
- **Sniffgenital/Sniffface/Sniffbody å¬å›**: +3~8%
- **çŸ­æ®µæ£€æµ‹**: æ›´å¥½ï¼ˆå¹³æ»‘æ ¸=3ï¼‰
- **Sniffbody åˆå¹¶**: æ›´è¿ç»­ï¼ˆmerge_gap=8ï¼‰
- **æ•´ä½“ F1**: +1~3%

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### 1. å¯åŠ¨è®­ç»ƒ
```bash
python train_v8.2_local.py
```

### 2. ç›‘æ§è¾“å‡º
```
============================================================
V8.2 Fine-Tuned Multi-task Behavior Detection
Smoothing=3 + Lower Sniff Thresholds + Motion Gating
============================================================

Epoch 1/100
[Train] Loss: 0.3794 | Action Acc: 0.8383
[Val]   Loss: 0.3037 | Action Acc: 0.8694
[Kaggle] Interval F1: 0.6580 | Precision: 0.6920 | Recall: 0.6270

[OK] Saved best Kaggle F1 model (kaggle_f1=0.6580)
```

### 3. è®­ç»ƒå®Œæˆå
```bash
# æ£€æŸ¥æ¨¡å‹
ls -lh checkpoints/v8.2_fine_tuned/best_model.pth

# è¿è¡Œæ¨ç†
python inference_v8.2.py

# æäº¤
python submit_to_kaggle.py submission_v8.2.csv
```

---

## ğŸ“ ä¿å­˜çš„æ¨¡å‹

- `best_model.pth` - **Kaggle F1 æœ€é«˜** â† ç”¨äºæäº¤
- `best_model_acc.pth` - å¸§å‡†ç¡®ç‡æœ€é«˜
- `last_model.pth` - æœ€æ–°æ£€æŸ¥ç‚¹

---

## â±ï¸ é¢„è®¡è®­ç»ƒæ—¶é—´

- æ¯ä¸ª epoch: ~2.5 åˆ†é’Ÿ
- é¢„è®¡ epochs: 30-50
- **æ€»æ—¶é—´: 1-2 å°æ—¶**

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### V8.2 åå¤„ç†é…ç½®
```python
CLASS_CONFIG = {
    'sniffgenital': {
        'prob_threshold': 0.25,  # V8.2: lowered
        'frac_high_threshold': 0.20
    },
    'sniffface': {
        'prob_threshold': 0.26,  # V8.2: lowered
        'frac_high_threshold': 0.20
    },
    'sniffbody': {
        'prob_threshold': 0.25,  # V8.2: lowered
        'merge_gap': 8,  # V8.2: increased
        'frac_high_threshold': 0.20
    },
    'escape': {
        'prob_threshold': 0.55,
        'max_required': 0.65,
        'velocity_min': 80.0  # Motion gating
    },
    'freeze': {
        'prob_threshold': 0.25,
        'velocity_max': 7.0  # Motion gating + threshold relaxation
    }
}
```

### éªŒè¯æ—¶å¹³æ»‘
```python
# V8.2: kernel_size=3 (was 5 in V8.1)
action_probs_smooth = temporal_smoothing(
    action_probs_flat,
    kernel_size=3,  # â­ Critical change
    method='median'
)
```

---

## â“ FAQ

### Q: V8.2 å’Œ V8.1 çš„ä¸»è¦åŒºåˆ«ï¼Ÿ
A:
1. **å¹³æ»‘æ ¸ä» 5 é™åˆ° 3** - ä¿ç•™æ›´å¤šçŸ­æ®µ
2. **Sniff ç±»é˜ˆå€¼é™ä½** - æå‡å¬å›ç‡
3. **sniffbody åˆå¹¶é—´éš™å¢å¤§** - å‡å°‘ç¢ç‰‡åŒ–

### Q: ä¸ºä»€ä¹ˆå¹³æ»‘æ ¸ä» 5 é™åˆ° 3ï¼Ÿ
A: kernel_size=5 ä¼šè¿‡åº¦å¹³æ»‘ï¼Œä¸¢å¤±çŸ­æ—¶æ®µè¡Œä¸ºã€‚kernel_size=3 åœ¨é™å™ªå’Œä¿ç•™çŸ­æ®µä¹‹é—´æ›´å¹³è¡¡ã€‚

### Q: ä»€ä¹ˆæ—¶å€™ç”¨ V8.2 è€Œä¸æ˜¯ V8.1ï¼Ÿ
A: å¦‚æœä½ å‘ç° V8.1 åœ¨ sniff ç±»åˆ«çš„å¬å›ç‡ä¸å¤Ÿï¼Œæˆ–è€…çŸ­æ®µè¢«è¿‡æ»¤æ‰å¤ªå¤šï¼Œç”¨ V8.2ã€‚

### Q: å¯ä»¥ä» V8.1 æ¨¡å‹ç»§ç»­è®­ç»ƒå—ï¼Ÿ
A: å¯ä»¥ï¼Œå¤åˆ¶æƒé‡ï¼š
```bash
cp checkpoints/v8.1_optimized/best_model.pth checkpoints/v8.2_fine_tuned/pretrained.pth
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘

å¦‚æœ V8.2 æ•ˆæœå¥½ï¼Œå¯ä»¥ç»§ç»­å°è¯•ï¼š
1. å¾®è°ƒé€Ÿåº¦é˜ˆå€¼ï¼ˆescape: 60~100 px/sï¼‰
2. è°ƒæ•´ sniff çš„ max_required
3. é’ˆå¯¹æ€§ä¼˜åŒ–ä½ F1 çš„ç±»åˆ«

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿè¿è¡Œ `start_v8.2_training.bat` å¼€å§‹è®­ç»ƒï¼** ğŸš€
